var e,t,n,r,i,o,s,a,c;let u;!function(e){e.Busy="busy",e.Paused="Paused",e.Paused_Mode="PausedAlready",e.Resume="Resume",e.Confirmed="confirmed",e.Unauthorized="unauthorized"}(e||(e={})),function(e){e[e.APPROVED=1]="APPROVED",e[e.DECLINED=2]="DECLINED",e[e.REJECTED=3]="REJECTED",e[e.AUTHENTICATION_FAILED=4]="AUTHENTICATION_FAILED",e[e.INVALID_DEVICE_STATUS=5]="INVALID_DEVICE_STATUS",e[e.GENERAL_FAILURE=6]="GENERAL_FAILURE"}(t||(t={})),function(e){e[e.APPROVED=1]="APPROVED",e[e.DECLINED=2]="DECLINED",e[e.REJECTED=3]="REJECTED",e[e.AUTHENTICATION_FAILED=4]="AUTHENTICATION_FAILED",e[e.INVALID_DEVICE_STATUS=5]="INVALID_DEVICE_STATUS",e[e.GENERAL_FAILURE=6]="GENERAL_FAILURE"}(n||(n={})),function(e){e[e.FINISHED=1]="FINISHED",e[e.REJECTED=2]="REJECTED",e[e.AUTHENTICATION_FAILED=3]="AUTHENTICATION_FAILED",e[e.INVALID_DEVICE_STATUS=4]="INVALID_DEVICE_STATUS",e[e.GENERAL_FAILURE=5]="GENERAL_FAILURE"}(r||(r={})),function(e){e[e.BALANCED=1]="BALANCED",e[e.NOT_BALANCED=2]="NOT_BALANCED",e[e.REJECTED=3]="REJECTED",e[e.AUTHENTICATION_FAILED=4]="AUTHENTICATION_FAILED",e[e.INVALID_DEVICE_STATUS=5]="INVALID_DEVICE_STATUS",e[e.GENERAL_FAILURE=6]="GENERAL_FAILURE"}(i||(i={})),function(e){e[e.FINISHED=1]="FINISHED",e[e.AUTHENTICATION_FAILED=3]="AUTHENTICATION_FAILED",e[e.INVALID_DEVICE_STATUS=4]="INVALID_DEVICE_STATUS",e[e.GENERAL_FAILURE=5]="GENERAL_FAILURE"}(o||(o={})),function(e){e[e.FINISHED=1]="FINISHED",e[e.AUTHENTICATION_FAILED=2]="AUTHENTICATION_FAILED",e[e.INVALID_DEVICE_STATUS=3]="INVALID_DEVICE_STATUS",e[e.GENERAL_FAILURE=4]="GENERAL_FAILURE"}(s||(s={})),function(e){e[e.FINISHED=1]="FINISHED",e[e.AUTHENTICATION_FAILED=2]="AUTHENTICATION_FAILED",e[e.INVALID_DEVICE_STATUS=3]="INVALID_DEVICE_STATUS",e[e.GENERAL_FAILURE=4]="GENERAL_FAILURE"}(a||(a={})),function(e){e[e.BALANCED=1]="BALANCED",e[e.NOT_BALANCED=2]="NOT_BALANCED",e[e.REJECTED=3]="REJECTED",e[e.AUTHENTICATION_FAILED=4]="AUTHENTICATION_FAILED",e[e.INVALID_DEVICE_STATUS=5]="INVALID_DEVICE_STATUS",e[e.GENERAL_FAILURE=6]="GENERAL_FAILURE"}(c||(c={}));const h=new Uint8Array(16);function l(){if(!u&&(u="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!u))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return u(h)}const f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));var d,p={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function g(e,t,n){if(p.randomUUID&&!t&&!e)return p.randomUUID();const r=(e=e||{}).random||(e.rng||l)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase()}(r)}!function(e){e.CONNECTED="connected",e.CONNECTING="connecting",e.DISCONNECTED="disconnected",e.LOGGED_OUT="logged_out"}(d||(d={}));const E=e=>{};class y{static async connect(e,{onConnected:t=E,ondisconnected:n=E,onError:r=E,onMessage:i=E}){const o=new WebSocket(e);o.binaryType="arraybuffer";const s=new Promise(((e,s)=>{o?.addEventListener("open",(n=>{t(n),e(void 0)})),o?.addEventListener("close",n),o?.addEventListener("error",(e=>{r(e),s("Can't reach the given address")})),o?.addEventListener("message",i)}));return[o,s]}}class v{nearpay;connection_manager;listener;connectionInfo;connect(e){throw`please override the function ${arguments.callee.toString()} reconnect on the class (${this.constructor.name})`}disconnect(e){throw`please override the function ${arguments.callee.toString()}  on the class (${this.constructor.name})`}send(e){throw`please override the function ${arguments.callee.toString()}  on the class (${this.constructor.name})`}reconnect(e){throw`please override the function ${arguments.callee.toString()}  on the class (${this.constructor.name})`}isConnected(){throw`please override the function ${arguments.callee.toString()}  on the class (${this.constructor.name})`}getType(){throw`please override the function ${arguments.callee.toString()}  on the class (${this.constructor.name})`}getName(){throw`please override the function ${arguments.callee.toString()}  on the class (${this.constructor.name})`}getInfo(){throw`please override the function ${arguments.callee.toString()}  on the class (${this.constructor.name})`}getConnectionInfo(){return this.connectionInfo}constructor(e,t,n,r){this.nearpay=e,this.connection_manager=t,this.listener=n,this.connectionInfo=r}}var b="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_=[],I=[],m="undefined"!=typeof Uint8Array?Uint8Array:Array,A=!1;function T(){A=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)_[t]=e[t],I[e.charCodeAt(t)]=t;I["-".charCodeAt(0)]=62,I["_".charCodeAt(0)]=63}function w(e,t,n){for(var r,i,o=[],s=t;s<n;s+=3)r=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(_[(i=r)>>18&63]+_[i>>12&63]+_[i>>6&63]+_[63&i]);return o.join("")}function C(e){var t;A||T();for(var n=e.length,r=n%3,i="",o=[],s=16383,a=0,c=n-r;a<c;a+=s)o.push(w(e,a,a+s>c?c:a+s));return 1===r?(t=e[n-1],i+=_[t>>2],i+=_[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=_[t>>10],i+=_[t>>4&63],i+=_[t<<2&63],i+="="),o.push(i),o.join("")}function R(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,h=-7,l=n?i-1:0,f=n?-1:1,d=e[t+l];for(l+=f,o=d&(1<<-h)-1,d>>=-h,h+=a;h>0;o=256*o+e[t+l],l+=f,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+e[t+l],l+=f,h-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=u}return(d?-1:1)*s*Math.pow(2,o-r)}function N(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,h=(1<<u)-1,l=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(s++,c/=2),s+l>=h?(a=0,s=h):s+l>=1?(a=(t*c-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[n+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+d]=255&s,d+=p,s/=256,u-=8);e[n+d-p]|=128*g}var L={}.toString,D=Array.isArray||function(e){return"[object Array]"==L.call(e)};function P(){return S.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function O(e,t){if(P()<t)throw new RangeError("Invalid typed array length");return S.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=S.prototype:(null===e&&(e=new S(t)),e.length=t),e}function S(e,t,n){if(!(S.TYPED_ARRAY_SUPPORT||this instanceof S))return new S(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return F(this,e)}return U(this,e,t,n)}function U(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);S.TYPED_ARRAY_SUPPORT?(e=t).__proto__=S.prototype:e=j(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!S.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|G(t,n);e=O(e,r);var i=e.write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(V(t)){var n=0|M(t.length);return 0===(e=O(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?O(e,0):j(e,t);if("Buffer"===t.type&&D(t.data))return j(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function B(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function F(e,t){if(B(t),e=O(e,t<0?0:0|M(t)),!S.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function j(e,t){var n=t.length<0?0:0|M(t.length);e=O(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function M(e){if(e>=P())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+P().toString(16)+" bytes");return 0|e}function V(e){return!(null==e||!e._isBuffer)}function G(e,t){if(V(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return pe(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return ge(e).length;default:if(r)return pe(e).length;t=(""+t).toLowerCase(),r=!0}}function Y(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return ne(this,t,n);case"utf8":case"utf-8":return Q(this,t,n);case"ascii":return ee(this,t,n);case"latin1":case"binary":return te(this,t,n);case"base64":return Z(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return re(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function x(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function k(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=S.from(t,r)),V(t))return 0===t.length?-1:J(e,t,n,r,i);if("number"==typeof t)return t&=255,S.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):J(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function J(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var h=-1;for(o=n;o<a;o++)if(u(e,o)===u(t,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===c)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var l=!0,f=0;f<c;f++)if(u(e,o+f)!==u(t,f)){l=!1;break}if(l)return o}return-1}function H(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function $(e,t,n,r){return Ee(pe(t,e.length-n),e,n,r)}function W(e,t,n,r){return Ee(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function z(e,t,n,r){return W(e,t,n,r)}function q(e,t,n,r){return Ee(ge(t),e,n,r)}function X(e,t,n,r){return Ee(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function Z(e,t,n){return 0===t&&n===e.length?C(e):C(e.slice(t,n))}function Q(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,u=e[i],h=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=n)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(h=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=l}return function(e){var t=e.length;if(t<=K)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=K));return n}(r)}S.TYPED_ARRAY_SUPPORT=void 0===b.TYPED_ARRAY_SUPPORT||b.TYPED_ARRAY_SUPPORT,P(),S.poolSize=8192,S._augment=function(e){return e.__proto__=S.prototype,e},S.from=function(e,t,n){return U(null,e,t,n)},S.TYPED_ARRAY_SUPPORT&&(S.prototype.__proto__=Uint8Array.prototype,S.__proto__=Uint8Array),S.alloc=function(e,t,n){return function(e,t,n,r){return B(t),t<=0?O(e,t):void 0!==n?"string"==typeof r?O(e,t).fill(n,r):O(e,t).fill(n):O(e,t)}(null,e,t,n)},S.allocUnsafe=function(e){return F(null,e)},S.allocUnsafeSlow=function(e){return F(null,e)},S.isBuffer=function(e){return null!=e&&(!!e._isBuffer||ye(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&ye(e.slice(0,0))}(e))},S.compare=function(e,t){if(!V(e)||!V(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},S.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},S.concat=function(e,t){if(!D(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return S.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=S.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!V(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},S.byteLength=G,S.prototype._isBuffer=!0,S.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)x(this,t,t+1);return this},S.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)x(this,t,t+3),x(this,t+1,t+2);return this},S.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)x(this,t,t+7),x(this,t+1,t+6),x(this,t+2,t+5),x(this,t+3,t+4);return this},S.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Q(this,0,e):Y.apply(this,arguments)},S.prototype.equals=function(e){if(!V(e))throw new TypeError("Argument must be a Buffer");return this===e||0===S.compare(this,e)},S.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},S.prototype.compare=function(e,t,n,r,i){if(!V(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(r,i),u=e.slice(t,n),h=0;h<a;++h)if(c[h]!==u[h]){o=c[h],s=u[h];break}return o<s?-1:s<o?1:0},S.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},S.prototype.indexOf=function(e,t,n){return k(this,e,t,n,!0)},S.prototype.lastIndexOf=function(e,t,n){return k(this,e,t,n,!1)},S.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return H(this,e,t,n);case"utf8":case"utf-8":return $(this,e,t,n);case"ascii":return W(this,e,t,n);case"latin1":case"binary":return z(this,e,t,n);case"base64":return q(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return X(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},S.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var K=4096;function ee(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function te(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function ne(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=de(e[o]);return i}function re(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function ie(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function oe(e,t,n,r,i,o){if(!V(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function se(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function ae(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function ce(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function ue(e,t,n,r,i){return i||ce(e,0,n,4),N(e,t,n,r,23,4),n+4}function he(e,t,n,r,i){return i||ce(e,0,n,8),N(e,t,n,r,52,8),n+8}S.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),S.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=S.prototype;else{var i=t-e;n=new S(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},S.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||ie(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},S.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||ie(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},S.prototype.readUInt8=function(e,t){return t||ie(e,1,this.length),this[e]},S.prototype.readUInt16LE=function(e,t){return t||ie(e,2,this.length),this[e]|this[e+1]<<8},S.prototype.readUInt16BE=function(e,t){return t||ie(e,2,this.length),this[e]<<8|this[e+1]},S.prototype.readUInt32LE=function(e,t){return t||ie(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},S.prototype.readUInt32BE=function(e,t){return t||ie(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},S.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||ie(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},S.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||ie(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},S.prototype.readInt8=function(e,t){return t||ie(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},S.prototype.readInt16LE=function(e,t){t||ie(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},S.prototype.readInt16BE=function(e,t){t||ie(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},S.prototype.readInt32LE=function(e,t){return t||ie(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},S.prototype.readInt32BE=function(e,t){return t||ie(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},S.prototype.readFloatLE=function(e,t){return t||ie(e,4,this.length),R(this,e,!0,23,4)},S.prototype.readFloatBE=function(e,t){return t||ie(e,4,this.length),R(this,e,!1,23,4)},S.prototype.readDoubleLE=function(e,t){return t||ie(e,8,this.length),R(this,e,!0,52,8)},S.prototype.readDoubleBE=function(e,t){return t||ie(e,8,this.length),R(this,e,!1,52,8)},S.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||oe(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},S.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||oe(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},S.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||oe(this,e,t,1,255,0),S.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},S.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||oe(this,e,t,2,65535,0),S.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):se(this,e,t,!0),t+2},S.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||oe(this,e,t,2,65535,0),S.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):se(this,e,t,!1),t+2},S.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||oe(this,e,t,4,4294967295,0),S.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):ae(this,e,t,!0),t+4},S.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||oe(this,e,t,4,4294967295,0),S.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):ae(this,e,t,!1),t+4},S.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);oe(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},S.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);oe(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},S.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||oe(this,e,t,1,127,-128),S.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},S.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||oe(this,e,t,2,32767,-32768),S.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):se(this,e,t,!0),t+2},S.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||oe(this,e,t,2,32767,-32768),S.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):se(this,e,t,!1),t+2},S.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||oe(this,e,t,4,2147483647,-2147483648),S.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):ae(this,e,t,!0),t+4},S.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||oe(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),S.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):ae(this,e,t,!1),t+4},S.prototype.writeFloatLE=function(e,t,n){return ue(this,e,t,!0,n)},S.prototype.writeFloatBE=function(e,t,n){return ue(this,e,t,!1,n)},S.prototype.writeDoubleLE=function(e,t,n){return he(this,e,t,!0,n)},S.prototype.writeDoubleBE=function(e,t,n){return he(this,e,t,!1,n)},S.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!S.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},S.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!S.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=V(e)?e:pe(new S(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var le,fe=/[^+\/0-9A-Za-z-_]/g;function de(e){return e<16?"0"+e.toString(16):e.toString(16)}function pe(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function ge(e){return function(e){var t,n,r,i,o,s;A||T();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[a-2]?2:"="===e[a-1]?1:0,s=new m(3*a/4-o),r=o>0?a-4:a;var c=0;for(t=0,n=0;t<r;t+=4,n+=3)i=I[e.charCodeAt(t)]<<18|I[e.charCodeAt(t+1)]<<12|I[e.charCodeAt(t+2)]<<6|I[e.charCodeAt(t+3)],s[c++]=i>>16&255,s[c++]=i>>8&255,s[c++]=255&i;return 2===o?(i=I[e.charCodeAt(t)]<<2|I[e.charCodeAt(t+1)]>>4,s[c++]=255&i):1===o&&(i=I[e.charCodeAt(t)]<<10|I[e.charCodeAt(t+1)]<<4|I[e.charCodeAt(t+2)]>>2,s[c++]=i>>8&255,s[c++]=255&i),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(fe,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Ee(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function ye(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}class ve extends v{is_connected=!1;device=void 0;is_reconnecting=!1;error=!1;disconnect(e=undefined){if(this.device){if(!e)return this.device.close();if(e.force)return this.device.close(3333)}}async reconnect(e){return this.is_reconnecting=!0,this.disconnect(),this.connect(e)}onConnected(){this.is_connected=!0,this.is_reconnecting=!1,this.error=!1}onDisconnected(e){this.device=void 0,this.is_connected=!1,!this.nearpay.isLogedIn()||!this.is_reconnecting&&this.error?this.nearpay.disconnectDevice():(!e.code||e.code&&3333!==e.code)&&this.listener.dispatchConnectivityChange(d.DISCONNECTED)}onError(e){this.error=!0}async onMessage(e){if("string"==typeof e.data)return this.connection_manager.reviceCommand(e.data);try{const t=S.from(e.data).toString(),n=JSON.parse(t);this.connection_manager.reciveJob(n.jobId,n)}catch(e){console.log({e:e})}}isConnected(){return this.is_connected}async send(e){const t=JSON.stringify(e),n=S.from(t);return this.connection_manager.sendJob(e.jobId,e,(()=>{this.device?.send(n)}))}async WsConnect(e){const[t,n]=await y.connect(e,{onConnected:this.onConnected.bind(this),ondisconnected:this.onDisconnected.bind(this),onError:this.onError.bind(this),onMessage:this.onMessage.bind(this)});return this.device=t,n}}class be extends ve{static connector_name="Wireless";wsInfo=this.connectionInfo;getType(){return le.WS}static async isAvaiale(){return!0}getName(){return be.connector_name}getIp(){return this.wsInfo.ip}getPort(){return this.wsInfo.port}async connect(e){const t=`ws://${this.wsInfo.ip}:${this.wsInfo.port}/connect/${e}`;return this.WsConnect(t)}}!function(e){e.WS="Wireless"}(le||(le={}));const _e={[le.WS]:be};var Ie,me;!function(e){e.PURCHASE="0",e.REFUND="1",e.RECONCILE="2",e.REVERSE="3",e.GET_PENDING_TRANSACTIONS="4",e.GET_REVERSIBLE_TRANSACTIONS="5",e.GET_REFUNDABLE_TRANSACTIONS="6",e.GET_TRANSACTION="7",e.GET_ALL_RECONCILIATIONS="8",e.GET_RECONCILIATION="9",e.LOGOUT="10"}(Ie||(Ie={})),function(e){e.CREATE="0",e.CANCEL="1",e.END="2"}(me||(me={}));const Ae={timeout:6e4},Te="Message canceled for unexpected error";class we{lib_provider;inbox=[];constructor(e){this.lib_provider=e}async sendJob(e,t,n,{timeout:r=6e4}=Ae){return n(),new Promise(((n,r)=>{this.inbox.push({uuid:e,payload:t,reject:r,resolve:n,timeoutClear:()=>{}})}))}async reviceCommand(t){switch(t){case e.Paused:return void this.lib_provider.getListener().dispatchEvent("pause");case e.Resume:return void this.lib_provider.getListener().dispatchEvent("un-pause");case e.Busy:return this.lib_provider.getListener().dispatchEvent("connection-busy"),void this.lib_provider.getListener().dispatchConnectivityChange(d.LOGGED_OUT);case e.Paused_Mode:return this.lib_provider.getNearpay().cancelJob("You cant send messages while the pos are paused"),void this.lib_provider.getListener().dispatchEvent("pause");case e.Confirmed:return this.lib_provider.getListener().dispatchConnectivityChange(d.CONNECTED),this.lib_provider.getListener().dispatchEvent("connection-not-busy"),void this.lib_provider.getListener().dispatchEvent("un-pause");case e.Unauthorized:return void this.lib_provider.getListener().dispatchConnectivityChange(d.LOGGED_OUT)}}async reciveJob(e,t){const n=this.inbox.find((t=>t.uuid===e));if(void 0===n)return;const{resolve:r,timeoutClear:i}=n;r(t),i?.(),this.inbox=this.inbox.filter((t=>t.uuid!==e))}async rejectJob(e,t=Te){const n=this.inbox.find((t=>t.uuid===e));if(void 0===n)return;const{payload:r,reject:i,timeoutClear:o}=n;this.sendCancel(n).then((()=>{i(t),o?.(),this.inbox=this.inbox.filter((t=>t.uuid!==e))}))}async rejectAllJobs(e=Te){this.inbox.forEach((t=>{this.rejectJob(t.uuid,e)})),this.inbox=[]}async rejectLastJob(e=Te){const t=this.inbox[this.inbox.length-1];if(void 0===t)return;const{uuid:n}=t;this.rejectJob(n,e)}hasPendingJob(){return this.inbox.length>0}async sendCancel(e){const t=this.lib_provider.getNearpay(),n={...e.payload,commandType:me.CANCEL};await t.send(n)}}const Ce=["connected","disconnected","state-connected","state-connecting","state-disconnected","state-logged_out","logout","connectivity-change","availablity-change","pay","payment-result","setup","send-message","recive-message","reject-message","pause","un-pause","connection-busy","connection-not-busy"];function Re(e,t,...n){if(!e)throw new TypeError(Ne(t,n))}function Ne(e,t){let n=0;return e.replace(/%[os]/gu,(()=>Le(t[n++])))}function Le(e){return"object"!=typeof e||null===e?String(e):Object.prototype.toString.call(e)}const De="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:void 0;class Pe{constructor(e,t){this.code=e,this.message=t}warn(...e){var t;try{undefined;const n=(null!==(t=(new Error).stack)&&void 0!==t?t:"").replace(/^(?:.+?\n){2}/gu,"\n");console.warn(this.message,...e,n)}catch(e){}}}const Oe=new Pe("W01","Unable to initialize event under dispatching."),Se=new Pe("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),Ue=new Pe("W03","Assigning any truthy value to 'returnValue' property has no effect."),Be=new Pe("W04","Unable to preventDefault on non-cancelable events."),Fe=new Pe("W05","Unable to preventDefault inside passive event listener invocation."),je=new Pe("W06","An event listener wasn't added because it has been added already: %o, %o"),Me=new Pe("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),Ve=new Pe("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o");class Ge{static get NONE(){return Ye}static get CAPTURING_PHASE(){return xe}static get AT_TARGET(){return ke}static get BUBBLING_PHASE(){return Je}constructor(e,t){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=null!=t?t:{};He.set(this,{type:String(e),bubbles:Boolean(n.bubbles),cancelable:Boolean(n.cancelable),composed:Boolean(n.composed),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return $e(this).type}get target(){return $e(this).target}get srcElement(){return $e(this).target}get currentTarget(){return $e(this).currentTarget}composedPath(){const e=$e(this).currentTarget;return e?[e]:[]}get NONE(){return Ye}get CAPTURING_PHASE(){return xe}get AT_TARGET(){return ke}get BUBBLING_PHASE(){return Je}get eventPhase(){return $e(this).dispatchFlag?2:0}stopPropagation(){$e(this).stopPropagationFlag=!0}get cancelBubble(){return $e(this).stopPropagationFlag}set cancelBubble(e){e?$e(this).stopPropagationFlag=!0:Se.warn()}stopImmediatePropagation(){const e=$e(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return $e(this).bubbles}get cancelable(){return $e(this).cancelable}get returnValue(){return!$e(this).canceledFlag}set returnValue(e){e?Ue.warn():We($e(this))}preventDefault(){We($e(this))}get defaultPrevented(){return $e(this).canceledFlag}get composed(){return $e(this).composed}get isTrusted(){return!1}get timeStamp(){return $e(this).timeStamp}initEvent(e,t=!1,n=!1){const r=$e(this);r.dispatchFlag?Oe.warn():He.set(this,{...r,type:String(e),bubbles:Boolean(t),cancelable:Boolean(n),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}}const Ye=0,xe=1,ke=2,Je=3,He=new WeakMap;function $e(e,t="this"){const n=He.get(e);return Re(null!=n,"'%s' must be an object that Event constructor created, but got another one: %o",t,e),n}function We(e){e.inPassiveListenerFlag?Fe.warn():e.cancelable?e.canceledFlag=!0:Be.warn()}Object.defineProperty(Ge,"NONE",{enumerable:!0}),Object.defineProperty(Ge,"CAPTURING_PHASE",{enumerable:!0}),Object.defineProperty(Ge,"AT_TARGET",{enumerable:!0}),Object.defineProperty(Ge,"BUBBLING_PHASE",{enumerable:!0});const ze=Object.getOwnPropertyNames(Ge.prototype);for(let e=0;e<ze.length;++e)"constructor"!==ze[e]&&Object.defineProperty(Ge.prototype,ze[e],{enumerable:!0});let qe;void 0!==De&&void 0!==De.Event&&Object.setPrototypeOf(Ge.prototype,De.Event.prototype);const Xe={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function Ze(e){const t=Object.keys(Xe);for(let n=0;n<t.length;++n){const r=t[n],i=Xe[r];Object.defineProperty(e,r,{get:()=>i,configurable:!0,enumerable:!0})}}class Qe extends Ge{static wrap(e){return new(nt(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),Ke.set(this,{original:e});const t=Object.keys(e);for(let n=0;n<t.length;++n){const r=t[n];r in this||Object.defineProperty(this,r,rt(e,r))}}stopPropagation(){super.stopPropagation();const{original:e}=et(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;const{original:t}=et(this);"cancelBubble"in t&&(t.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();const{original:e}=et(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;const{original:t}=et(this);"returnValue"in t&&(t.returnValue=e)}preventDefault(){super.preventDefault();const{original:e}=et(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){const{original:e}=et(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}}const Ke=new WeakMap;function et(e){const t=Ke.get(e);return Re(null!=t,"'this' is expected an Event object, but got",e),t}const tt=new WeakMap;function nt(e){const t=Object.getPrototypeOf(e);if(null==t)return Qe;let n=tt.get(t);return null==n&&(n=function(e,t){class n extends e{}const r=Object.keys(t);for(let e=0;e<r.length;++e)Object.defineProperty(n.prototype,r[e],rt(t,r[e]));return n}(nt(t),t),tt.set(t,n)),n}function rt(e,t){const n=Object.getOwnPropertyDescriptor(e,t);return{get(){const e=et(this).original,n=e[t];return"function"==typeof n?n.bind(e):n},set(e){et(this).original[t]=e},configurable:n.configurable,enumerable:n.enumerable}}function it(e){return 1==(1&e.flags)}function ot(e){return 2==(2&e.flags)}function st(e){return 4==(4&e.flags)}function at(e){return 8==(8&e.flags)}function ct({callback:e},t,n){try{"function"==typeof e?e.call(t,n):"function"==typeof e.handleEvent&&e.handleEvent(n)}catch(e){!function(e){try{const t=e instanceof Error?e:new Error(Le(e));if("function"==typeof dispatchEvent&&"function"==typeof ErrorEvent)dispatchEvent(new ErrorEvent("error",{error:t,message:t.message}));else if("undefined"!=typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)}catch(e){}}(e)}}function ut({listeners:e},t,n){for(let r=0;r<e.length;++r)if(e[r].callback===t&&it(e[r])===n)return r;return-1}function ht(e,t,n){const r=ut(e,t,n);return-1!==r&&lt(e,r)}function lt(e,t,n=!1){const r=e.listeners[t];return function(e){e.flags|=8}(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),e.cow&&!n?(e.cow=!1,e.listeners=e.listeners.filter(((e,n)=>n!==t)),!1):(e.listeners.splice(t,1),!0)}tt.set(Object.prototype,Qe),void 0!==De&&void 0!==De.Event&&tt.set(De.Event.prototype,Qe);class ft{constructor(){dt.set(this,Object.create(null))}addEventListener(e,t,n){const r=pt(this),{callback:i,capture:o,once:s,passive:a,signal:c,type:u}=function(e,t,n){var r;if(gt(t),"object"==typeof n&&null!==n)return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture),passive:Boolean(n.passive),once:Boolean(n.once),signal:null!==(r=n.signal)&&void 0!==r?r:void 0};return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n),passive:!1,once:!1,signal:void 0}}(e,t,n);if(null==i||(null==c?void 0:c.aborted))return;const h=function(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e[t]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}(r,u),l=ut(h,i,o);-1===l?function(e,t,n,r,i,o){let s;o&&(s=ht.bind(null,e,t,n),o.addEventListener("abort",s));const a=function(e,t,n,r,i,o){return{callback:e,flags:(t?1:0)|(n?2:0)|(r?4:0),signal:i,signalListener:o}}(t,n,r,i,o,s);e.cow?(e.cow=!1,e.listeners=[...e.listeners,a]):e.listeners.push(a)}(h,i,o,a,s,c):function(e,t,n,r){je.warn(it(e)?"capture":"bubble",e.callback),ot(e)!==t&&Me.warn("passive");st(e)!==n&&Me.warn("once");e.signal!==r&&Me.warn("signal")}(h.listeners[l],a,s,c)}removeEventListener(e,t,n){const r=pt(this),{callback:i,capture:o,type:s}=function(e,t,n){if(gt(t),"object"==typeof n&&null!==n)return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture)};return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n)}}(e,t,n),a=r[s];null!=i&&a&&ht(a,i,o)}dispatchEvent(e){const t=pt(this)[String(e.type)];if(null==t)return!0;const n=e instanceof Ge?e:Qe.wrap(e),r=$e(n,"event");if(r.dispatchFlag)throw i="This event has been in dispatching.",De.DOMException?new De.DOMException(i,"InvalidStateError"):(null==qe&&(qe=class e extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,e)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(qe.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),Ze(qe),Ze(qe.prototype)),new qe(i));var i;if(r.dispatchFlag=!0,r.target=r.currentTarget=this,!r.stopPropagationFlag){const{cow:e,listeners:i}=t;t.cow=!0;for(let o=0;o<i.length;++o){const s=i[o];if(!at(s)&&(st(s)&&lt(t,o,!e)&&(o-=1),r.inPassiveListenerFlag=ot(s),ct(s,this,n),r.inPassiveListenerFlag=!1,r.stopImmediatePropagationFlag))break}e||(t.cow=!1)}return r.target=null,r.currentTarget=null,r.stopImmediatePropagationFlag=!1,r.stopPropagationFlag=!1,r.dispatchFlag=!1,!r.canceledFlag}}const dt=new WeakMap;function pt(e,t="this"){const n=dt.get(e);return Re(null!=n,"'%s' must be an object that EventTarget constructor created, but got another one: %o",t,e),n}function gt(e){if("function"!=typeof e&&("object"!=typeof e||null===e||"function"!=typeof e.handleEvent)){if(null!=e&&"object"!=typeof e)throw new TypeError(Ne(Ve.message,[e]));Ve.warn(e)}}const Et=Object.getOwnPropertyNames(ft.prototype);for(let e=0;e<Et.length;++e)"constructor"!==Et[e]&&Object.defineProperty(ft.prototype,Et[e],{enumerable:!0});void 0!==De&&void 0!==De.EventTarget&&Object.setPrototypeOf(ft.prototype,De.EventTarget.prototype);class yt{lib_provider;constructor(e){this.lib_provider=e}event=new ft;addEventListener(e,t,n){if(!Ce.includes(e))throw Error("unsupported event type");return this.event.addEventListener(e,t,n),()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,n){if(!Ce.includes(e))throw Error("unsupported event type");this.event.removeEventListener(e,t,n)}dispatchEvent(e){if(!Ce.includes(e))throw Error("unsupported event type");const t=new Ge(e);this.event.dispatchEvent(t)}dispatchConnectivityChange(e){this.dispatchEvent(`state-${e}`)}}function vt({jobId:e,messageId:t,command:n,commandType:r,body:i}){return{jobId:e,messageId:t,command:n,commandType:r,metaData:{platform:"",device_id:"",device_user:"",os_version:"",sdk_version:"",payment_plugin_version:""},payload:i}}class bt{static PurchasePayload({jobId:e,messageId:t,commandType:n,body:r}){return vt({jobId:e,messageId:t,command:Ie.PURCHASE,commandType:n,body:r})}static RefundPayload({jobId:e,messageId:t,commandType:n,body:r}){return vt({jobId:e,messageId:t,command:Ie.REFUND,commandType:n,body:r})}static ReversalPayload({jobId:e,messageId:t,commandType:n,body:r}){return vt({jobId:e,messageId:t,command:Ie.REVERSE,commandType:n,body:r})}static ReconciliationPayload({jobId:e,messageId:t,commandType:n,body:r}){return vt({jobId:e,messageId:t,command:Ie.RECONCILE,commandType:n,body:r})}}class _t{lib_provider;constructor(e){this.lib_provider=e}update(){return this}async purchase({jobId:e=g(),messageId:t=g(),amount:n,enable_ui_dismiss:r=!0,reference_id:i="",enable_receipt_ui:o=!0,enable_reversal:s=!0,finish_timeout:a=6e4}){if(this.lib_provider.getNearpay().hasPendingJob())throw"connot send a job while there is a job pending";const c=bt.PurchasePayload({jobId:e,messageId:t,commandType:me.CREATE,body:{amount:n,customerReferenceNumber:i,enableReceiptUi:o,enableReversal:s,finishTimeOut:a,enableUiDismiss:r}});return this.lib_provider.getNearpay().send(c)}async refund({jobId:e=g(),messageId:t=g(),amount:n,original_transaction_uuid:r,enable_ui_dismiss:i=!0,reference_id:o="",enable_receipt_ui:s=!0,enable_reversal:a=!0,enable_editable_refund_amount_ui:c=!0,finish_timeout:u=6e4}){if(this.lib_provider.getNearpay().hasPendingJob())throw"connot send a job while there is a job pending";const h=bt.RefundPayload({jobId:e,messageId:t,commandType:me.CREATE,body:{amount:n,transactionUUID:r,customerReferenceNumber:o,enableReceiptUi:s,enableReversal:a,enableEditableRefundAmountUi:c,finishTimeOut:u,enableUiDismiss:i}});return this.lib_provider.getNearpay().send(h)}async reversal({jobId:e=g(),messageId:t=g(),original_transaction_uuid:n,enable_receipt_ui:r=!0,finish_timeout:i=6e4}){if(this.lib_provider.getNearpay().hasPendingJob())throw"connot send a job while there is a job pending";const o=bt.ReversalPayload({jobId:e,messageId:t,commandType:me.CREATE,body:{transactionUUID:n,enableReceiptUi:r,finishTimeOut:i}});return this.lib_provider.getNearpay().send(o)}async reconcile({jobId:e=g(),messageId:t=g(),enable_receipt_ui:n=!0,finish_timeout:r=6e4}){if(this.lib_provider.getNearpay().hasPendingJob())throw"connot send a job while there is a job pending";const i=bt.ReconciliationPayload({jobId:e,messageId:t,commandType:me.CREATE,body:{enableReceiptUi:n,finishTimeOut:r}});return this.lib_provider.getNearpay().send(i)}}class It{constructor(e){this.nearpay=e,this.listener=new yt(this),this.connection_manager=new we(this),this.terminal=new _t(this)}terminal;nearpay;listener;connector=void 0;connection_manager;getTerminal(){return this.terminal}getNearpay(){return this.nearpay}getListener(){return this.listener}getConnector(){return this.connector}getConnectionManager(){return this.connection_manager}setConnector(e){this.connector=e}}class mt{static async get(e){return new Promise((async(t,n)=>{const[r]=await y.connect(e,{onMessage:function({data:e}){t(e),r.close()}})}))}}class At{lib_provider=new It(this);state=d.LOGGED_OUT;is_paused=!1;is_busy=!1;recovaryMode=!1;tryingToConnect=!1;is_loggedin=!1;constructor(){this.addConnectivityListener((e=>this.state=e)),this.addConnectivityListener((e=>{e===d.LOGGED_OUT&&(this.is_loggedin=!1,this.releaseConnector(),this.cancelJob())})),this.addConnectivityListener((e=>{e===d.CONNECTING?this.tryingToConnect=!0:this.tryingToConnect=!1})),this.addConnectivityListener((e=>{e===d.CONNECTED&&(this.is_loggedin=!0)})),this.addConnectivityListener((e=>{d.DISCONNECTED})),this.addPauseListener((e=>this.is_paused=e)),this.addBusyListener((e=>this.is_busy=e))}addConnectivityListener(e){const t=[this.lib_provider.getListener().addEventListener("state-connected",(function(){e(d.CONNECTED)})),this.lib_provider.getListener().addEventListener("state-disconnected",(function(){e(d.DISCONNECTED)})),this.lib_provider.getListener().addEventListener("state-connecting",(function(){e(d.CONNECTING)})),this.lib_provider.getListener().addEventListener("state-logged_out",(function(){e(d.LOGGED_OUT)}))];return()=>t.forEach((e=>e()))}addPauseListener(e){function t(t){e(!0)}function n(t){e(!1)}return this.lib_provider.getListener().addEventListener("un-pause",n),this.lib_provider.getListener().addEventListener("pause",t),()=>{this.lib_provider.getListener().removeEventListener("un-pause",n),this.lib_provider.getListener().removeEventListener("pause",t)}}addBusyListener(e){function t(t){e(!1)}function n(t){e(!0)}return this.lib_provider.getListener().addEventListener("connection-not-busy",t),this.lib_provider.getListener().addEventListener("connection-busy",n),()=>{this.lib_provider.getListener().removeEventListener("connection-not-busy",t),this.lib_provider.getListener().removeEventListener("connection-busy",n)}}addAutoReconnect(e=1e3){const t=setInterval((async()=>{if(this.state!==d.DISCONNECTED)return()=>{};const e=await this.getProfile();if(void 0===e)return()=>{};this.is_busy||this.reconnect(e.id).catch((e=>{}))}),e);return()=>clearInterval(t)}getConenctor(){return this.lib_provider.getConnector()}getConnectorType(){const e=this.lib_provider.getConnector();if(e)return e.getType()}getCurrentConnectionInfo(){const e=this.lib_provider.getConnector();if(e)return e.getConnectionInfo()}async getAvaliableConnector(){return[{name:be.connector_name,type:le.WS,available:await be.isAvaiale()}]}async releaseConnector(){const e=this.lib_provider.getConnector();e&&(e.disconnect({force:!0}),this.lib_provider.setConnector(void 0))}async connect(e){if(this.state===d.CONNECTED)return void alert("NearPay is already connected to POS device");this.disconnectDevice();const t=await this.checkProfileIdIsValid(e)?(await this.getProfile())?.id:await this.requestConnectionUuid(e);if(void 0!==t)return this.StartConnection(e,t);alert("NearPay is busy with other device")}async connectToLastUser(){if(this.state!==d.LOGGED_OUT)return;const e=await this.getLastConnection(),t=await this.getProfile();return void 0!==t&&void 0!==e?await this.StartConnection(e,t.id).catch((e=>{})):void 0}async reconnect(e){if(this.tryingToConnect)return;const t=this.getConenctor();return t?(this.lib_provider.getListener().dispatchConnectivityChange(d.CONNECTING),t.reconnect(e)):void 0}async send(e){const t=this.lib_provider.getConnector();if(void 0!==t&&this.isConnected()){if(!this.is_paused)return t.send(e).then((e=>e));alert("cannot send message while the pos in pause mode")}else alert("cannot send message with no connection")}cancelJob(e="Job canceled"){this.lib_provider.getConnectionManager().hasPendingJob()&&this.lib_provider.getConnectionManager().rejectAllJobs(e)}isConnected(){const e=this.lib_provider.getConnector();return void 0!==e&&e.isConnected()}isLogedIn(){return this.is_loggedin}getState(){return this.state}isPaused(){return this.is_paused}isBusy(){return this.is_busy}disconnectDevice(){this.lib_provider.getListener().dispatchConnectivityChange(d.LOGGED_OUT)}async forgetDevice(){const e=await this.getProfile();if(void 0===e)return;const t=this.getConenctor()?.getConnectionInfo();return void 0!==t?await mt.get(`ws://${t.ip}:${t.port}/forget/${e.id}`).then((e=>"confirmed"===e)).finally((()=>this.disconnectDevice())):void 0}getTerminal(){return this.lib_provider.getTerminal()}hasPendingJob(){return this.lib_provider.getConnectionManager().hasPendingJob()}recoveryAfterDisconnection(){this.addConnectivityListener((e=>{let t=0;if(e!==d.CONNECTED&&e!==d.LOGGED_OUT){if(e===d.DISCONNECTED&&this.hasPendingJob()&&!this.recovaryMode){this.recovaryMode=!0;const e=setInterval((async()=>{t>=10&&(this.recovaryMode=!1,clearInterval(e),this.cancelJob("Job canceled for disconnection")),this.state===d.CONNECTED&&(this.recovaryMode=!1,clearInterval(e)),t++;const n=await this.getIdOrGenerate();this.reconnect(n)}),200)}}else this.recovaryMode=!1}))}async getIdOrGenerate(){return await this.getProfile().then((e=>e?.id??g()))}async checkProfileIdIsValid(e){const t=await this.getProfile();return void 0!==t&&await mt.get(`ws://${e.ip}:${e.port}/check/${t.id}`).then((e=>"valid"===e))}async requestConnectionUuid(e){return await mt.get(`ws://${e.ip}:${e.port}/pair`).then((e=>"busy"===e?void 0:/uuid:(.*)/.exec(e)?.at(1)))}async StartConnection(e,t){const n=new(0,_e[e.type])(this,this.lib_provider.getConnectionManager(),this.lib_provider.getListener(),e);return this.lib_provider.setConnector(n),this.lib_provider.getListener().dispatchConnectivityChange(d.CONNECTING),n.connect(t).then((()=>{this.saveProfile({id:t}),this.saveConnection(e)})).catch((e=>{throw this.disconnectDevice(),e}))}async getProfile(){throw"You must override the method (getProfile)"}async saveProfile(e){throw"You must override the method (saveProfile)"}async getLastConnection(){throw"You must override the method (getLastConnection)"}async saveConnection(e){throw"You must override the method (saveConnection)"}}export{d as CONNECTION_STATE,le as NEARPAY_CONNECTOR,At as NearPay,t as PURCHASE_STATUS,a as RECONCILIATIONS_QUERY_STATUS,c as RECONCILIATION_QUERY_STATUS,i as RECONCILIATION_STATUS,n as REFUND_STATUS,r as REVERSAL_STATUS,s as TRANSACTIONS_QUERY_STATUS,o as TRANSACTION_QUERY_STATUS};
